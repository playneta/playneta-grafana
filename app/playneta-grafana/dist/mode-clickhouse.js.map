{"version":3,"sources":["../src/mode-clickhouse.js"],"names":["ace","define","require","exports","module","oop","TextHighlightRules","ClickhouseInfo","ClickHouseHighlightRules","keywords","KeywordsRe","builtinConstants","ConstantsRe","builtinFunctions","FunctionsRe","dataTypes","DataTypesRe","keywordMapper","createKeywordMapper","$rules","token","regex","start","end","normalizeRules","inherits","lang","keyWordsCompletions","Keywords","map","word","caption","value","meta","score","Number","MAX_VALUE","macrosCompletions","MacrosCompletions","item","name","docHTML","convertToHTML","functionsCompletions","FunctionsCompletions","wrapText","str","len","lines","space_index","line_start","next_line_end","line","i","length","slice","push","join","convertMarkDownTags","text","replace","docText","escapeHTML","def","ClickhouseCompletions","getCompletions","state","session","pos","prefix","callback","getTokenAt","row","column","type","completions","concat","call","prototype","TextMode","Mode","HighlightRules","$completer","completer","$id"],"mappings":";;;;;;;;AAAA;AACA;;AAEAA,gBAAIC,MAAJ,CAAW,qCAAX,EAAkD,CAAC,SAAD,EAAY,SAAZ,EAAuB,QAAvB,EAAiC,aAAjC,EAAgD,+BAAhD,CAAlD,EAAoI,UAAUC,OAAV,EAAmBC,OAAnB,EAA4BC,MAA5B,EAAoC;AACpK;;AAEA,oBAAIC,MAAMH,QAAQ,YAAR,CAAV;AACA,oBAAII,qBAAqBJ,QAAQ,wBAAR,EAAkCI,kBAA3D;AACA,oBAAIC,iBAAiBL,QAAQ,mBAAR,EAA6BK,cAAlD;;AAEA,oBAAIC,2BAA2B,SAA3BA,wBAA2B,GAAY;AACvC,wBAAIC,WAAWF,eAAeG,UAAf,EAAf;AAAA,wBACIC,mBAAmBJ,eAAeK,WAAf,EADvB;AAAA,wBAEIC,mBAAmBN,eAAeO,WAAf,EAFvB;AAAA,wBAGIC,YAAYR,eAAeS,WAAf,EAHhB;;AAKA,wBAAIC,gBAAgB,KAAKC,mBAAL,CAAyB;AACzC,4CAAoBL,gBADqB;AAEzC,mCAAWJ,QAF8B;AAGzC,6CAAqBE,gBAHoB;AAIzC,wCAAgBI;AAJyB,qBAAzB,EAKjB,YALiB,EAKH,IALG,CAApB;;AAOA,yBAAKI,MAAL,GAAc;AACV,iCAAS,CAAC;AACNC,mCAAO,SADD;AAENC,mCAAO;AAFD,yBAAD,EAGN;AACCD,mCAAO,eADR;AAECE,mCAAO,KAFR;AAGCC,iCAAK;AAHN,yBAHM,EAON;AACCH,mCAAO,QADR,EAC4B;AAC3BC,mCAAO;AAFR,yBAPM,EAUN;AACCD,mCAAO,kBADR,EAC4B;AAC3BC,mCAAO;AAFR,yBAVM,EAaN;AACCD,mCAAOH,aADR;AAECI,mCAAO;AAFR,yBAbM,EAgBN;AACCD,mCAAO,kBADR;AAECC,mCAAO;AAFR,yBAhBM,EAmBN;AACCD,mCAAO,cADR;AAECC,mCAAO;AAFR,yBAnBM,EAsBN;AACCD,mCAAO,cADR;AAECC,mCAAO;AAFR,yBAtBM,EAyBN;AACCD,mCAAO,MADR;AAECC,mCAAO;AAFR,yBAzBM;AADC,qBAAd;AA+BA,yBAAKG,cAAL;AACH,iBA7CD;;AA+CAnB,oBAAIoB,QAAJ,CAAajB,wBAAb,EAAuCF,kBAAvC;;AAEAH,wBAAQK,wBAAR,GAAmCA,wBAAnC;AACH,aAzDD;;AA2DAR,gBAAIC,MAAJ,CAAW,iCAAX,EAA8C,CAAC,SAAD,EAAY,SAAZ,EAAuB,QAAvB,EAAiC,oBAAjC,EAAuD,cAAvD,CAA9C,EAAsH,UAAUC,OAAV,EAAmBC,OAAnB,EAA4BC,MAA5B,EAAoC;AACtJ;;AAEA,oBAAIsB,OAAOxB,QAAQ,aAAR,CAAX;AAAA,oBACIK,iBAAiBL,QAAQ,mBAAR,EAA6BK,cADlD;;AAGA,oBAAIoB,sBAAsBpB,eAAeqB,QAAf,CAAwBC,GAAxB,CAA4B,UAAUC,IAAV,EAAgB;AAClE,2BAAO;AACHC,iCAASD,IADN;AAEHE,+BAAOF,IAFJ;AAGHG,8BAAM,SAHH;AAIHC,+BAAOC,OAAOC;AAJX,qBAAP;AAMH,iBAPyB,CAA1B;;AASA,oBAAIC,oBAAoB9B,eAAe+B,iBAAf,GAAmCT,GAAnC,CAAuC,UAAUU,IAAV,EAAgB;AAC3E,2BAAO;AACHR,iCAASQ,KAAKC,IADX;AAEHR,+BAAOO,KAAKC,IAFT;AAGHC,iCAASC,cAAcH,IAAd,CAHN;AAIHN,8BAAM,QAJH;AAKHC,+BAAOC,OAAOC;AALX,qBAAP;AAOH,iBARuB,CAAxB;;AAUA,oBAAIO,uBAAuBpC,eAAeqC,oBAAf,GAAsCf,GAAtC,CAA0C,UAAUU,IAAV,EAAgB;AACjF,2BAAO;AACHR,iCAASQ,KAAKC,IADX;AAEHR,+BAAOO,KAAKC,IAAL,GAAU,IAFd;AAGHC,iCAASC,cAAcH,IAAd,CAHN;AAIHN,8BAAM,UAJH;AAKHC,+BAAOC,OAAOC;AALX,qBAAP;AAOH,iBAR0B,CAA3B;;AAUA,yBAASS,QAAT,CAAkBC,GAAlB,EAAuBC,GAAvB,EAA4B;AACxBA,0BAAMA,OAAO,EAAb;AACA,wBAAIC,QAAQ,EAAZ;AACA,wBAAIC,cAAc,CAAlB;AACA,wBAAIC,aAAa,CAAjB;AACA,wBAAIC,gBAAgBJ,GAApB;AACA,wBAAIK,OAAO,EAAX;AACA,yBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIP,IAAIQ,MAAxB,EAAgCD,GAAhC,EAAqC;AACjC,4BAAIP,IAAIO,CAAJ,MAAW,GAAf,EAAoB;AAChBJ,0CAAcI,CAAd;AACH,yBAFD,MAEO,IAAIA,KAAKF,aAAL,IAAuBF,gBAAgB,CAA3C,EAA8C;AACjDG,mCAAON,IAAIS,KAAJ,CAAUL,UAAV,EAAsBD,WAAtB,CAAP;AACAD,kCAAMQ,IAAN,CAAWJ,IAAX;AACAF,yCAAaD,cAAc,CAA3B;AACAE,4CAAgBE,IAAIN,GAApB;AACAE,0CAAc,CAAd;AACH;AACJ;AACDG,2BAAON,IAAIS,KAAJ,CAAUL,UAAV,CAAP;AACAF,0BAAMQ,IAAN,CAAWJ,IAAX;AACA,2BAAOJ,MAAMS,IAAN,CAAW,WAAX,CAAP;AACH;;AAED,yBAASC,mBAAT,CAA6BC,IAA7B,EAAmC;AAC/BA,2BAAOA,KAAKC,OAAL,CAAa,YAAb,EAA2B,eAA3B,CAAP;AACAD,2BAAOA,KAAKC,OAAL,CAAa,WAAb,EAA0B,iBAA1B,CAAP;AACA,2BAAOD,IAAP;AACH;;AAED,yBAASjB,aAAT,CAAuBH,IAAvB,EAA6B;AACzB,wBAAIsB,UAAUnC,KAAKoC,UAAL,CAAgBvB,KAAKsB,OAArB,CAAd;AACAA,8BAAUH,oBAAoBb,SAASgB,OAAT,EAAkB,EAAlB,CAApB,CAAV;AACA,2BAAO,CACH,KADG,EACInC,KAAKoC,UAAL,CAAgBvB,KAAKwB,GAArB,CADJ,EAC+B,MAD/B,EACuC,WADvC,EACoDF,OADpD,EAC6D,WAD7D,EAELJ,IAFK,CAEA,EAFA,CAAP;AAGH;;AAED,oBAAIO,wBAAwB,SAAxBA,qBAAwB,GAAY,CACvC,CADD;;AAGA,iBAAC,YAAY;AACT,yBAAKC,cAAL,GAAsB,UAAUC,KAAV,EAAiBC,OAAjB,EAA0BC,GAA1B,EAA+BC,MAA/B,EAAuCC,QAAvC,EAAiD;AACnE,4BAAIlD,QAAQ+C,QAAQI,UAAR,CAAmBH,IAAII,GAAvB,EAA4BJ,IAAIK,MAAhC,CAAZ;AACA,4BAAIrD,MAAMsD,IAAN,KAAe,iBAAf,IAAoCtD,MAAMsD,IAAN,KAAe,eAAvD,EAAwE;AACpE,mCAAOJ,SAAS,IAAT,EAAe,EAAf,CAAP;AACH;;AAED,4BAAIK,cAAchD,oBAAoBiD,MAApB,CAA2BjC,oBAA3B,CAAlB;AACAgC,sCAAcA,YAAYC,MAAZ,CAAmBvC,iBAAnB,CAAd;AACAiC,iCAAS,IAAT,EAAeK,WAAf;AACH,qBATD;AAWH,iBAZD,EAYGE,IAZH,CAYQb,sBAAsBc,SAZ9B;;AAcA3E,wBAAQ6D,qBAAR,GAAgCA,qBAAhC;AACH,aA1FD;;AA6FAhE,gBAAIC,MAAJ,CAAW,qBAAX,EAAkC,CAAC,SAAD,EAAY,SAAZ,EAAuB,QAAvB,EAAiC,aAAjC,EAAgD,eAAhD,EAAiE,qCAAjE,CAAlC,EAA2I,UAAUC,OAAV,EAAmBC,OAAnB,EAA4BC,MAA5B,EAAoC;AAC3K;;AAEA,oBAAIC,MAAMH,QAAQ,YAAR,CAAV;AACA,oBAAI6E,WAAW7E,QAAQ,QAAR,EAAkB8E,IAAjC;AACA,oBAAIxE,2BAA2BN,QAAQ,8BAAR,EAAwCM,wBAAvE;AACA,oBAAIwD,wBAAwB9D,QAAQ,0BAAR,EAAoC8D,qBAAhE;;AAGA,oBAAIgB,OAAO,SAAPA,IAAO,GAAY;AACnB,yBAAKC,cAAL,GAAsBzE,wBAAtB;AACA,yBAAK0E,UAAL,GAAkB,IAAIlB,qBAAJ,EAAlB;AACA;AACA,yBAAKmB,SAAL,GAAiB,KAAKD,UAAtB;AACH,iBALD;;AAOA7E,oBAAIoB,QAAJ,CAAauD,IAAb,EAAmBD,QAAnB;;AAEA,iBAAC,YAAY;AACT,yBAAKK,GAAL,GAAW,qBAAX;AACH,iBAFD,EAEGP,IAFH,CAEQG,KAAKF,SAFb;;AAIA3E,wBAAQ6E,IAAR,GAAeA,IAAf;AACH,aAvBD","file":"mode-clickhouse.js","sourcesContent":["// jshint ignore: start\n// jscs: disable\n\nace.define(\"ace/mode/clickhouse_highlight_rules\", [\"require\", \"exports\", \"module\", \"ace/lib/oop\", \"ace/mode/text_highlight_rules\"], function (require, exports, module) {\n    \"use strict\";\n\n    var oop = require(\"../lib/oop\");\n    var TextHighlightRules = require(\"./text_highlight_rules\").TextHighlightRules;\n    var ClickhouseInfo = require(\"./clickhouse_info\").ClickhouseInfo;\n\n    var ClickHouseHighlightRules = function () {\n        var keywords = ClickhouseInfo.KeywordsRe(),\n            builtinConstants = ClickhouseInfo.ConstantsRe(),\n            builtinFunctions = ClickhouseInfo.FunctionsRe(),\n            dataTypes = ClickhouseInfo.DataTypesRe();\n\n        var keywordMapper = this.createKeywordMapper({\n            \"support.function\": builtinFunctions,\n            \"keyword\": keywords,\n            \"constant.language\": builtinConstants,\n            \"storage.type\": dataTypes\n        }, \"identifier\", true);\n\n        this.$rules = {\n            \"start\": [{\n                token: \"comment\",\n                regex: \"--.*$\"\n            }, {\n                token: \"comment.block\",\n                start: \"```\",\n                end: \"```\"\n            }, {\n                token: \"string\",           // ' string\n                regex: \"'.*?'\"\n            }, {\n                token: \"constant.numeric\", // float\n                regex: \"[+-]?\\\\d+(?:(?:\\\\.\\\\d*)?(?:[eE][+-]?\\\\d+)?)?\\\\b\"\n            }, {\n                token: keywordMapper,\n                regex: \"[a-zA-Z_$][a-zA-Z0-9_$]*\\\\b\"\n            }, {\n                token: \"keyword.operator\",\n                regex: \"\\\\+|\\\\-|\\\\/|\\\\/\\\\/|%|<@>|@>|<@|&|\\\\^|~|<|>|<=|=>|==|!=|<>|=\"\n            }, {\n                token: \"paren.lparen\",\n                regex: \"[\\\\(]\"\n            }, {\n                token: \"paren.rparen\",\n                regex: \"[\\\\)]\"\n            }, {\n                token: \"text\",\n                regex: \"\\\\s+\"\n            }]\n        };\n        this.normalizeRules();\n    };\n\n    oop.inherits(ClickHouseHighlightRules, TextHighlightRules);\n\n    exports.ClickHouseHighlightRules = ClickHouseHighlightRules;\n});\n\nace.define(\"ace/mode/clickhouse_completions\", [\"require\", \"exports\", \"module\", \"ace/token_iterator\", \"ace/lib/lang\"], function (require, exports, module) {\n    \"use strict\";\n\n    var lang = require(\"../lib/lang\"),\n        ClickhouseInfo = require(\"./clickhouse_info\").ClickhouseInfo;\n\n    var keyWordsCompletions = ClickhouseInfo.Keywords.map(function (word) {\n        return {\n            caption: word,\n            value: word,\n            meta: \"keyword\",\n            score: Number.MAX_VALUE\n        }\n    });\n\n    var macrosCompletions = ClickhouseInfo.MacrosCompletions().map(function (item) {\n        return {\n            caption: item.name,\n            value: item.name,\n            docHTML: convertToHTML(item),\n            meta: \"macros\",\n            score: Number.MAX_VALUE\n        };\n    });\n\n    var functionsCompletions = ClickhouseInfo.FunctionsCompletions().map(function (item) {\n        return {\n            caption: item.name,\n            value: item.name+\"()\",\n            docHTML: convertToHTML(item),\n            meta: \"function\",\n            score: Number.MAX_VALUE\n        };\n    });\n\n    function wrapText(str, len) {\n        len = len || 90;\n        var lines = [];\n        var space_index = 0;\n        var line_start = 0;\n        var next_line_end = len;\n        var line = \"\";\n        for (var i = 0; i < str.length; i++) {\n            if (str[i] === ' ') {\n                space_index = i;\n            } else if (i >= next_line_end  && space_index !== 0) {\n                line = str.slice(line_start, space_index);\n                lines.push(line);\n                line_start = space_index + 1;\n                next_line_end = i + len;\n                space_index = 0;\n            }\n        }\n        line = str.slice(line_start);\n        lines.push(line);\n        return lines.join(\"&nbsp<br>\");\n    }\n\n    function convertMarkDownTags(text) {\n        text = text.replace(/```(.+)```/, \"<pre>$1</pre>\");\n        text = text.replace(/`([^`]+)`/, \"<code>$1</code>\");\n        return text;\n    }\n\n    function convertToHTML(item) {\n        var docText = lang.escapeHTML(item.docText);\n        docText = convertMarkDownTags(wrapText(docText, 40));\n        return [\n            \"<b>\", lang.escapeHTML(item.def), \"</b>\", \"<hr></hr>\", docText, \"<br>&nbsp\"\n        ].join(\"\");\n    }\n\n    var ClickhouseCompletions = function () {\n    };\n\n    (function () {\n        this.getCompletions = function (state, session, pos, prefix, callback) {\n            var token = session.getTokenAt(pos.row, pos.column);\n            if (token.type === 'entity.name.tag' || token.type === 'string.quoted') {\n                return callback(null, []);\n            }\n\n            var completions = keyWordsCompletions.concat(functionsCompletions);\n            completions = completions.concat(macrosCompletions);\n            callback(null, completions);\n        };\n\n    }).call(ClickhouseCompletions.prototype);\n\n    exports.ClickhouseCompletions = ClickhouseCompletions;\n});\n\n\nace.define(\"ace/mode/clickhouse\", [\"require\", \"exports\", \"module\", \"ace/lib/oop\", \"ace/mode/text\", \"ace/mode/clickhouse_highlight_rules\"], function (require, exports, module) {\n    \"use strict\";\n\n    var oop = require(\"../lib/oop\");\n    var TextMode = require(\"./text\").Mode;\n    var ClickHouseHighlightRules = require(\"./clickhouse_highlight_rules\").ClickHouseHighlightRules;\n    var ClickhouseCompletions = require(\"./clickhouse_completions\").ClickhouseCompletions;\n\n\n    var Mode = function () {\n        this.HighlightRules = ClickHouseHighlightRules;\n        this.$completer = new ClickhouseCompletions();\n        // replace keyWordCompleter\n        this.completer = this.$completer;\n    };\n\n    oop.inherits(Mode, TextMode);\n\n    (function () {\n        this.$id = \"ace/mode/clickhouse\";\n    }).call(Mode.prototype);\n\n    exports.Mode = Mode;\n});\n\n"]}